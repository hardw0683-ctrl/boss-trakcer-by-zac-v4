<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Loot Drop Tracker</title>
    <link rel="icon" href="Launcher.ico" />

    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: url("https://i.imgur.com/kcX2vZF.jpeg") no-repeat center
          center fixed;
        background-size: cover;
        color: #f8e4b0;
        padding: 40px;
        margin: 0;
        background-image: url('background.jpg');
  background-size: cover;       /* Make sure image covers the entire area */
  background-position: center;  /* Center the image */
  background-repeat: no-repeat; /* Do not repeat the image */
      }

      .container {
        max-width: 700px;
        margin: auto;
        background-color: rgba(25, 20, 20, 0.9);
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 0 25px rgba(0, 0, 0, 0.7);
        border: 2px solid #d4af37;
      }

      h1,
      h2 {
        text-align: center;
        color: #ffd700;
        margin-bottom: 25px;
      }

      label {
        font-weight: bold;
        font-size: 18px;
        display: block;
        margin-bottom: 10px;
      }

      select {
        width: 100%;
        padding: 12px;
        border-radius: 10px;
        border: 2px solid #d4af37;
        background-color: #1e1e1e;
        color: #fff5cc;
        font-size: 16px;
        margin-bottom: 20px;
      }

      .player-list label {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        cursor: pointer;
      }

      .player-list input {
        margin-right: 10px;
        transform: scale(1.3);
      }

      #logDropBtn {
        width: 100%;
        padding: 15px;
        font-size: 18px;
        background-color: #ffcc00;
        color: #1a1a1a;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        margin-top: 15px;
        transition: background-color 0.3s;
      }

      #logDropBtn:hover {
        background-color: #ffdb4d;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 30px;
        color: #fff0c2;
      }

      th,
      td {
        padding: 14px;
        border: 1px solid #d4af37;
        background-color: rgba(50, 40, 20, 0.9);
        text-align: center;
      }

      th {
        background-color: #3e2d1b;
        color: #ffd700;
      }

      option {
        background-color: #2c2c2c;
      }

      .item-icon {
        width: 20px;
        vertical-align: middle;
        margin-right: 8px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ Loot Drop Tracker</h1>

      <label for="itemSelect">Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø°ÙŠ Ø³Ù‚Ø·:</label>
      <select id="itemSelect">
        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù†ØµØ± --</option>
        <option value="Ø¨Ø·Ø§Ù‚Ø© Ø´Ø§ÙŠÙ†ÙˆÙƒ" data-value="1500">
          ğŸƒ Ø¨Ø·Ø§Ù‚Ø© Ø´Ø§ÙŠÙ†ÙˆÙƒ (1500 Ù†Ù‚Ø·Ø©)
        </option>
        <option value="Ù‚Ù†Ø§Ø¹ Ù†Ø¬Ù… Ø­Ø¯ÙŠØ¯ÙŠ {ØªØµÙÙŠØ­}" data-value="100">
          ğŸ›¡ï¸ Ù‚Ù†Ø§Ø¹ Ù†Ø¬Ù… Ø­Ø¯ÙŠØ¯ÙŠ {ØªØµÙÙŠØ­} (100 Ù†Ù‚Ø·Ø©)
        </option>
        <option value="Ù‚Ù†Ø§Ø¹ Ù†Ø¬Ù… Ø­Ø¯ÙŠØ¯ÙŠ {Ø§Ù†ÙØ¬Ø§Ø±}" data-value="300">
          ğŸ’¥ Ù‚Ù†Ø§Ø¹ Ù†Ø¬Ù… Ø­Ø¯ÙŠØ¯ÙŠ {Ø§Ù†ÙØ¬Ø§Ø±} (300 Ù†Ù‚Ø·Ø©)
        </option>
        <option value="Ø¨Ø·Ø§Ù‚Ø© ØªØ´ÙˆØ¨ÙˆØ³ Ø³Ø§Ø­Ø±" data-value="1500">
          ğŸ”® Ø¨Ø·Ø§Ù‚Ø© ØªØ´ÙˆØ¨ÙˆØ³ Ø³Ø§Ø­Ø± (1500 Ù†Ù‚Ø·Ø©)
        </option>
        <option value="Ø¨Ø·Ø§Ù‚Ø© ØªØ´ÙˆØ¨ÙˆØ³ Ø¨Ø±Ø§Ø±ÙŠ" data-value="2000">
          ğŸŒ¿ Ø¨Ø·Ø§Ù‚Ø© ØªØ´ÙˆØ¨ÙˆØ³ Ø¨Ø±Ø§Ø±ÙŠ (2000 Ù†Ù‚Ø·Ø©)
        </option>
        <option value="Ø¨Ø·Ø§Ù‚Ø© ØªØ´ÙˆØ¨ÙˆØ³ Ø­Ø±Ø¨ÙŠ" data-value="1500">
          âš”ï¸ Ø¨Ø·Ø§Ù‚Ø© ØªØ´ÙˆØ¨ÙˆØ³ Ø­Ø±Ø¨ÙŠ (1500 Ù†Ù‚Ø·Ø©)
        </option>
      </select>

      <div class="player-list" id="playerList"></div>

      <button id="logDropBtn">Log Drop</button>

      <h2>ğŸ† Leaderboard</h2>
      <table id="leaderboard">
        <thead>
          <tr>
            <th>Player</th>
            <th>Points</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div style="text-align: center;">
      <button
        id="clearAllBtn"
        style="
          margin-top: 15px;
          width: 30%;
          padding: 12px;
          background-color: #ef0808;
          color: white;
          font-weight: bold;
          border: none;
          border-radius: 10px;
          cursor: pointer;
          transition: background-color 0.3s;
        "
      >
        ğŸ—‘ï¸ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù†Ù‚Ø§Ø·
      </button>
      <section id="itemManagement" style="margin-top: 40px; background: rgba(30,30,30,0.9); padding: 20px; border-radius: 12px; color: #f8e4b0;">
        <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ±</h2>
      
        <table id="itemsTable" style="width: 100%; margin-bottom: 20px; border-collapse: collapse;">
          <thead>
            <tr style="border-bottom: 2px solid #d4af37;">
              <th style="text-align: left; padding: 8px;">Ø§Ù„Ø¹Ù†ØµØ±</th>
              <th style="text-align: left; padding: 8px;">Ø§Ù„Ù†Ù‚Ø§Ø·</th>
              <th>Ø­Ø°Ù</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      
        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
          <input type="text" id="newItemName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ±" style="flex: 2; padding: 8px; border-radius: 6px; border: 1px solid #d4af37;" />
          <input type="number" id="newItemPoints" placeholder="Ø§Ù„Ù†Ù‚Ø§Ø·" style="flex: 1; padding: 8px; border-radius: 6px; border: 1px solid #d4af37;" />
          <button id="addItemBtn" style="flex: 1; background: #ffd700; border: none; border-radius: 8px; cursor: pointer;">Ø£Ø¶Ù Ø¹Ù†ØµØ±</button>
        </div>
      
        <div id="itemMessage" style="color: #ffcc00;"></div>
      </section>
      <div style="text-align: center; margin-top: 15px;">
        <button
          id="backToIndexBtn"
          style="
            width: 30%;
            padding: 12px;
            background-color: #007acc;
            color: white;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 15px;
          "
        >
          ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        </button>
      </div>
    <script type="module">
      import { db } from "./firebase-config.js";
      import {
        ref,
        onValue,
        set,
        update,
        get,
      } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

      const players = ["zac", "mahmoud", "mohamed", "mina", "ragab"];

      const playerListDiv = document.getElementById("playerList");
      playerListDiv.innerHTML = ""; // clear old

      players.forEach((name) => {
        const label = document.createElement("label");
        label.innerHTML = `<input type="checkbox" value="${name}"> ${name}`;
        playerListDiv.appendChild(label);
      });

      async function logDropToFirebase(itemName, itemPoints, selectedPlayers) {
        const pointsPerPlayer = Math.floor(itemPoints / selectedPlayers.length);
        const updates = {};

        for (const player of selectedPlayers) {
          const playerRef = ref(db, `leaderboard/${player}`);
          const snapshot = await get(playerRef);
          const oldPoints = snapshot.exists() ? snapshot.val() : 0;
          updates[`leaderboard/${player}`] = oldPoints + pointsPerPlayer;
        }

        await update(ref(db), updates);
        alert(
          `Logged ${itemName} (${itemPoints} pts) split between: ${selectedPlayers.join(
            ", "
          )}`
        );
      }

      const leaderboardTable = document
        .getElementById("leaderboard")
        .querySelector("tbody");

      function updateLeaderboardTable(data) {
        leaderboardTable.innerHTML = "";
        Object.entries(data).forEach(([player, points]) => {
          const row = document.createElement("tr");
          row.innerHTML = `<td>${player}</td><td>${points}</td>`;
          leaderboardTable.appendChild(row);
        });
      }

      onValue(ref(db, "leaderboard"), (snapshot) => {
        const data = snapshot.val() || {};
        updateLeaderboardTable(data);
      });

      document
        .getElementById("logDropBtn")
        .addEventListener("click", async () => {
          const itemName = itemSelect.value;
          const itemPoints = parseInt(
            itemSelect.selectedOptions[0]?.dataset.value || "0"
          );
          if (!itemName || !itemPoints) return alert("Please select an item");

          const selectedPlayers = Array.from(
            playerListDiv.querySelectorAll("input:checked")
          ).map((c) => c.value);
          if (selectedPlayers.length === 0)
            return alert("Please select at least one player");

          await logDropToFirebase(itemName, itemPoints, selectedPlayers);

          itemSelect.selectedIndex = 0;
          playerListDiv
            .querySelectorAll("input:checked")
            .forEach((c) => (c.checked = false));
        });
      document
        .getElementById("clearAllBtn")
        .addEventListener("click", async () => {
          const confirmClear = confirm(
            "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·ØŸ"
          );
          if (!confirmClear) return;

          try {
            // Clear leaderboard in Firebase
            await set(ref(db, "leaderboard"), null);

            // Clear leaderboard table on page
            const leaderboardTable = document
              .getElementById("leaderboard")
              .querySelector("tbody");
            leaderboardTable.innerHTML = "";

            alert("ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·!");
          } catch (error) {
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø³Ø­: " + error.message);
          }
        });
        document.getElementById("backToIndexBtn").addEventListener("click", () => {
  window.location.href = "index.html";
});

const itemsTableBody = document.querySelector("#itemsTable tbody");
const newItemNameInput = document.getElementById("newItemName");
const newItemPointsInput = document.getElementById("newItemPoints");
const addItemBtn = document.getElementById("addItemBtn");
const itemMessage = document.getElementById("itemMessage");

function renderItems(items) {
  itemsTableBody.innerHTML = "";
  Object.entries(items).forEach(([name, data]) => {
    const row = document.createElement("tr");

    row.innerHTML = `
      <td style="padding: 8px;">
        <input type="text" class="edit-item-name" value="${name}" style="width: 100%; padding: 4px; border-radius: 4px; border: 1px solid #d4af37;" disabled />
      </td>
      <td style="padding: 8px;">
        <input type="number" class="edit-item-points" value="${data.points}" style="width: 100%; padding: 4px; border-radius: 4px; border: 1px solid #d4af37;" />
      </td>
      <td style="text-align: center; cursor: pointer; color: #ef0808; font-weight: bold;">âŒ</td>
    `;

    // Save changes when points input changes (debounced for performance)
    const pointsInput = row.querySelector(".edit-item-points");
    pointsInput.addEventListener("change", async () => {
      const newPoints = parseInt(pointsInput.value);
      if (isNaN(newPoints) || newPoints < 0) {
        alert("Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ù„Ù†Ù‚Ø§Ø·");
        pointsInput.value = data.points;
        return;
      }
      await update(ref(db, `items/${name}`), { points: newPoints });
      itemMessage.textContent = `ØªÙ… ØªØ­Ø¯ÙŠØ« Ù†Ù‚Ø§Ø· Ø§Ù„Ø¹Ù†ØµØ± "${name}" Ø¥Ù„Ù‰ ${newPoints}`;
      clearTimeout(window.itemMsgTimeout);
      window.itemMsgTimeout = setTimeout(() => (itemMessage.textContent = ""), 3000);
    });

    // Delete item on click X
    const deleteCell = row.querySelector("td:last-child");
    deleteCell.addEventListener("click", async () => {
      if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ± "${name}"ØŸ`)) {
        await set(ref(db, `items/${name}`), null);
        itemMessage.textContent = `ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù†ØµØ± "${name}"`;
        clearTimeout(window.itemMsgTimeout);
        window.itemMsgTimeout = setTimeout(() => (itemMessage.textContent = ""), 3000);
      }
    });

    itemsTableBody.appendChild(row);
  });
}

// Load items and render
onValue(ref(db, "items"), (snapshot) => {
  const items = snapshot.val() || {};
  renderItems(items);
  populateItemSelect(items); // To update your select dropdown dynamically (see below)
});

// Add new item button
addItemBtn.addEventListener("click", async () => {
  const name = newItemNameInput.value.trim();
  const points = parseInt(newItemPointsInput.value);

  if (!name) {
    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù†ØµØ±");
    return;
  }
  if (isNaN(points) || points < 0) {
    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© Ù†Ù‚Ø§Ø· ØµØ­ÙŠØ­Ø©");
    return;
  }

  // Add new item to Firebase
  await update(ref(db, `items/${name}`), { points });

  newItemNameInput.value = "";
  newItemPointsInput.value = "";
  itemMessage.textContent = `ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ± "${name}"`;
  clearTimeout(window.itemMsgTimeout);
  window.itemMsgTimeout = setTimeout(() => (itemMessage.textContent = ""), 3000);
});

// Function to update your <select> with latest items (call it after items loaded)
function populateItemSelect(items) {
  const itemSelect = document.getElementById("itemSelect");
  itemSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù†ØµØ± --</option>';

  for (const [name, data] of Object.entries(items)) {
    const option = document.createElement("option");
    option.value = name;
    option.dataset.value = data.points;
    option.textContent = `${name} (${data.points} Ù†Ù‚Ø·Ø©)`;
    itemSelect.appendChild(option);
  }
}

    </script>
  </body>
</html>
